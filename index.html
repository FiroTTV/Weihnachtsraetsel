<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>3eryk? Weihnachtsr√§tsel üéÑ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg:#020617;
      --card-bg:rgba(15,23,42,0.9);
      --border:rgba(148,163,184,0.3);
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --accent:#38bdf8;
      --error:#f97373;
      --success:#4ade80;
    }

    body {
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 55%);
      color:var(--text-main);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Schneeflocken */
    .snowflake {
      position:fixed;
      top:-10px;
      color:#fff;
      opacity:0.8;
      pointer-events:none;
      z-index:5;
      animation:fall linear infinite;
    }
    @keyframes fall { to { transform:translateY(110vh); } }

    .container {
      max-width:900px;
      margin:0 auto;
      padding:32px 16px 64px;
      position:relative;
    }

    .title {
      text-align:center;
      margin-bottom:24px;
    }
    .title h1 {
      margin:0;
      font-size:clamp(1.8rem,3vw,2.4rem);
    }

    /* Countdown */
    #countdown {
      margin-top:16px;
      font-size:2.2rem;
      font-weight:800;
      color:var(--accent);
      text-shadow:0 0 10px rgba(56,189,248,0.7);
      animation:pulseGlow 2.2s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%{transform:scale(1);}
      50%{transform:scale(1.05);}
      100%{transform:scale(1);}
    }

    /* Cards */
    .card {
      background:var(--card-bg);
      border-radius:16px;
      border:1px solid var(--border);
      padding:20px 18px;
      margin-bottom:18px;
      box-shadow:0 18px 40px rgba(0,0,0,0.5);
    }
    .card-header {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .badge {
      font-size:0.75rem;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--text-muted);
    }

    iframe {
      width:100%;
      max-width:600px;
      height:338px;
      margin:0 auto;
      display:block;
      border-radius:12px;
      border:none;
      background:#020617;
    }

    /* Zeichen-Fortschritt */
    .letters-progress {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .letters-progress span {
      width:20px;
      text-align:center;
      padding:3px 0;
      border-radius:6px;
      background:rgba(15,23,42,0.7);
      border:1px solid rgba(148,163,184,0.35);
      font-size:0.9rem;
    }
    .letters-progress span.filled {
      border-color:var(--accent);
    }

    /* Inputs */
    input[type="text"],
    input[type="password"] {
      width:100%;
      padding:10px 14px;
      margin-top:6px;
      font-size:1rem;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.25);
      background:rgba(255,255,255,0.06);
      color:#e5e7eb;
      outline:none;
      transition:0.25s ease;
      box-sizing:border-box;
    }
    input:hover {
      border-color:rgba(148,163,184,0.4);
    }
    input:focus {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.45);
      background:rgba(255,255,255,0.10);
    }

    .question-row {
      background:rgba(255,255,255,0.03);
      padding:14px 16px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.15);
      margin-bottom:14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
    }
    .question-row p {
      margin:0 0 6px;
      font-weight:600;
    }

    .message.success { color:var(--success); margin-top:6px; }
    .message.error { color:var(--error); margin-top:6px; }

    .letter-badge {
      padding:2px 6px;
      background:rgba(56,189,248,0.25);
      border-radius:6px;
      border:1px solid rgba(56,189,248,0.4);
      font-weight:700;
    }

    button {
      padding:8px 18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:white;
      background:linear-gradient(90deg,#3b82f6,#a855f7);
      transition:0.2s;
      font-size:0.95rem;
      margin-top:6px;
      box-shadow:0 3px 12px rgba(0,0,0,0.3);
    }
    button:hover { transform:scale(1.04); }
    button:disabled { opacity:0.6; cursor:not-allowed; }

    .hidden { display:none !important; }

    #reset-progress {
      background:linear-gradient(90deg,#ef4444,#f97316);
      margin-top:32px;
      width:220px;
      display:block;
      margin-left:auto;
      margin-right:auto;
    }

    #next-unlock-countdown {
      margin-top:8px;
      font-size:1.4rem;
      font-weight:700;
      color:var(--accent);
      text-shadow:0 0 12px rgba(56,189,248,0.5);
      text-align:center;
    }
    #next-unlock-text {
      text-align:center;
      margin-bottom:4px;
    }

    /* === BURGER-MEN√ú === */
    .burger-btn {
      position:fixed;
      top:10px;
      right:10px;
      width:46px;
      height:46px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,0.7);
      transition:0.2s;
      z-index:50;
    }
    .burger-btn:hover {
      transform:scale(1.08);
      border-color:var(--accent);
      box-shadow:0 0 18px rgba(56,189,248,0.6);
    }

    .burger-lines {
      width:20px;
      height:16px;
      position:relative;
    }
    .burger-lines span {
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:#e5e7eb;
      border-radius:999px;
      transition:0.25s;
    }
    .burger-lines span:nth-child(1){ top:0; }
    .burger-lines span:nth-child(2){ top:7px; }
    .burger-lines span:nth-child(3){ top:14px; }

    .burger-open .burger-lines span:nth-child(1){
      transform:translateY(7px) rotate(45deg);
    }
    .burger-open .burger-lines span:nth-child(2){ opacity:0; }
    .burger-open .burger-lines span:nth-child(3){
      transform:translateY(-7px) rotate(-45deg);
    }

    .menu-overlay {
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.75);
      backdrop-filter:blur(4px);
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.25s;
    }
    .menu-overlay.active {
      opacity:1;
      pointer-events:auto;
    }

    .side-menu {
      position:fixed;
      top:0;
      right:0;
      width:260px;
      max-width:85%;
      height:100vh;
      background:rgba(15,23,42,0.98);
      border-left:1px solid rgba(148,163,184,0.4);
      box-shadow:-16px 0 30px rgba(0,0,0,0.7);
      transform:translateX(100%);
      transition:transform 0.25s ease-out;
      z-index:60;
      padding:20px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .side-menu.active { transform:translateX(0); }

    .side-menu h3 { margin:0 0 10px; font-size:1.1rem; }
    .side-menu ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .side-menu li {
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      font-size:1rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(20,27,48,0.95);
      transition:0.2s;
    }

    .side-menu li span.label { flex:1; }

    .side-menu li span.tag {
      font-size:0.7rem;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      color:var(--text-muted);
      margin-left:8px;
    }

    .side-menu li:hover {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.7);
      transform:translateX(-2px);
    }

    .side-menu li.locked {
      opacity:0.45;
      cursor:not-allowed;
      border-style:dashed;
      box-shadow:none;
    }
    .side-menu li.locked:hover {
      transform:none;
      box-shadow:none;
      border-color:rgba(148,163,184,0.35);
    }
  </style>
</head>

<body>

<!-- Schneefall -->
<script>
function createSnowflake(){
  const s=document.createElement("div");
  s.className="snowflake";
  s.textContent="‚ùÑ";
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=10+Math.random()*18+"px";
  s.style.animationDuration=4+Math.random()*6+"s";
  s.style.opacity=0.4+Math.random()*0.4;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),11000);
}
setInterval(createSnowflake,200);
</script>

<!-- Soundeffekte -->
<script>
let audioCtx=null;
function getAudioCtx(){
  if(!audioCtx){
    const C=window.AudioContext||window.webkitAudioContext;
    if(C) audioCtx=new C();
  }
  return audioCtx;
}
function playTone(f,d,t="sine",v=0.12){
  const c=getAudioCtx(); if(!c) return;
  const o=c.createOscillator(), g=c.createGain();
  o.type=t; o.frequency.value=f; g.gain.value=v;
  o.connect(g); g.connect(c.destination);
  const now=c.currentTime;
  o.start(now); o.stop(now+d);
  g.gain.setValueAtTime(v,now);
  g.gain.linearRampToValueAtTime(0,now+d);
}
const playClick=()=>playTone(650,0.07,"triangle",0.1);
const playSuccess=()=>{ playTone(880,0.1); setTimeout(()=>playTone(1040,0.1),90); };
const playError=()=>playTone(220,0.14,"square",0.12);
</script>

<!-- Overlay & Men√º -->
<div id="menu-overlay" class="menu-overlay hidden"></div>

<nav id="side-menu" class="side-menu hidden">
  <h3>Navigation</h3>
  <ul>
    <li data-target="puzzle-0"><span class="label">R√§tsel 1 ‚Äì Quiz</span><span class="tag">Start</span></li>
    <li data-target="puzzle-1"><span class="label">R√§tsel 2</span></li>
    <li data-target="puzzle-2"><span class="label">R√§tsel 3</span></li>
    <li data-target="puzzle-3"><span class="label">R√§tsel 4</span></li>
    <li data-target="puzzle-4"><span class="label">R√§tsel 5</span></li>
    <li data-target="puzzle-5"><span class="label">R√§tsel 6 ‚Äì Spotify</span></li>
    <li data-target="final-card"><span class="label">Finale</span><span class="tag">Ende</span></li>
  </ul>
</nav>

<!-- Burger Button -->
<button id="burger-btn" class="burger-btn">
  <div class="burger-lines">
    <span></span><span></span><span></span>
  </div>
</button>

<div class="container">

  <div class="title">
    <h1>üéÑ 3eryk? Weihnachtsr√§tsel ‚Äì 2025 Edition üéÑ</h1>
    <div id="countdown">Lade Countdown...</div>
  </div>

  <!-- ADMIN LOGIN -->
  <div class="card">
    <div class="card-header"><span class="badge">Admin</span><h2>Admin Login</h2></div>
    <p>Passwort eingeben, um alles freizuschalten:</p>
    <input id="admin-pass" type="password" placeholder="Passwort">
    <button id="admin-btn">Login</button>
    <div id="admin-msg" class="message"></div>
  </div>

  <!-- INTRO -->
  <div class="card">
    <div class="card-header"><span class="badge">Intro</span><h2>Willkommen!</h2></div>
    <iframe src="https://www.youtube.com/embed/TGvnbko2Jio?si=z0f59smM_qRPTszH" allowfullscreen></iframe>
  </div>

  <!-- Fortschritt -->
  <div class="card">
    <div class="card-header"><span class="badge">Fortschritt</span><h2>Gesammelte Zeichen</h2></div>
    <div class="letters-progress" id="letters-progress">
      <!-- 29 Slots -->
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span>
    </div>
  </div>

  <!-- R√§tsel 1 ‚Äì Quiz -->
  <div class="card puzzle-card hidden" id="puzzle-0" data-index="0">
    <div class="card-header"><span class="badge">R√§tsel 1</span><h2>Quiz ‚Äì 8 Fragen</h2></div>
    <div id="quiz-summary" class="message">0 von 8 gel√∂st</div>

    <!-- Frage 1 -->
    <div class="question-row" data-solution="3" data-letter="3">
      <p>1. Aus wie vielen Alben besteht die Trilogie von TheWeeknd?</p>
      <input type="text" placeholder="Zahl eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 2 -->
    <div class="question-row" data-solution="25.09.2024" data-letter="e">
      <p>2. Wann war der erste call in der Discord Gruppe 3eryk?</p>
      <label><input type="radio" name="f2" value="10.08.2024"> 10.08.2024</label><br>
      <label><input type="radio" name="f2" value="25.09.2024"> 25.09.2024</label><br>
      <label><input type="radio" name="f2" value="01.10.2024"> 01.10.2024</label><br>
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 3 -->
    <div class="question-row" data-solution="rot ist meine lieblings zahl im ganzen alphabet" data-letter="r">
      <p>3. Rot....?</p>
      <input type="text" placeholder="ganzen Satz eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 4 -->
    <div class="question-row" data-solution="wann" data-letter="y">
      <p>4. Frage...?</p>
      <input type="text" placeholder="Antwort eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>
    <!-- Frage 5 -->
    <div class="question-row" data-solution="i" data-letter="?">
      <p>5. Rabsi, Manuel, Firo... Doch welche Endung ist die sch√∂nste?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 6 -->
    <div class="question-row" data-solution="t" data-letter="2">
      <p>6. Firo's aktueller lieblings Buchstabe...?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 7 -->
    <div class="question-row" data-solution="e" data-letter="0">
      <p>7. Firo findet Namen seit Neusten attraktiv... Doch welcher Buchstabe ist der weitverbreiteste in Namen?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 8 -->
    <div class="question-row" data-solution="47" data-letter="2">
      <p>8. Die WhatsApp-Gruppe von 3eryk? war schon ein gro√ües Upgrade. Doch wie viele Medien, Links und Docs wurden geteilt?</p>

      <label><input type="radio" name="f8" value="23"> 23</label><br>
      <label><input type="radio" name="f8" value="69"> 69</label><br>
      <label><input type="radio" name="f8" value="83"> 83</label><br>
      <label><input type="radio" name="f8" value="47"> 47</label><br>

      <button>Pr√ºfen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>
  </div>

  <!-- R√§tsel 2 -->
  <div class="card puzzle-card hidden" id="puzzle-1" data-index="1">
    <div class="card-header"><span class="badge">R√§tsel 2</span><h2>R√§tsel 2</h2></div>
    <p>Platzhalter f√ºr R√§tsel 2</p>
  </div>

  <!-- R√§tsel 3 -->
  <div class="card puzzle-card hidden" id="puzzle-2" data-index="2">
    <div class="card-header"><span class="badge">R√§tsel 3</span><h2>R√§tsel 3</h2></div>
    <p>Platzhalter f√ºr R√§tsel 3</p>
  </div>

  <!-- R√§tsel 4 -->
  <div class="card puzzle-card hidden" id="puzzle-3" data-index="3">
    <div class="card-header"><span class="badge">R√§tsel 4</span><h2>R√§tsel 4</h2></div>
    <p>Platzhalter f√ºr R√§tsel 4</p>
  </div>

  <!-- R√§tsel 5 -->
  <div class="card puzzle-card hidden" id="puzzle-4" data-index="4">
    <div class="card-header"><span class="badge">R√§tsel 5</span><h2>R√§tsel 5</h2></div>
    <p>Platzhalter f√ºr R√§tsel 5</p>
  </div>

  <!-- R√§tsel 6 ‚Äì Spotify -->
  <div class="card puzzle-card hidden" id="puzzle-5" data-index="5">
    <div class="card-header"><span class="badge">R√§tsel 6</span><h2>Spotify R√§tsel</h2></div>

    <p>
      H√∂re dir den Song  
      <strong>‚ÄûSao Paulo ‚Äì The Weeknd‚Äú</strong>  
      genau an und finde die drei gesuchten Zeichen.
    </p>

    <p><strong>Gib die drei Buchstaben einzeln ein:</strong></p>

    <div style="display:flex;gap:12px;">
      <input id="spotify-1" type="text" maxlength="1" placeholder="1.">
      <input id="spotify-2" type="text" maxlength="1" placeholder="2.">
      <input id="spotify-3" type="text" maxlength="1" placeholder="3.">
    </div>

    <button id="spotify-btn">Pr√ºfen</button>
    <div id="spotify-msg" class="message"></div>
  </div>

  <!-- Finale -->
  <div class="card puzzle-card hidden" id="final-card">
    <div class="card-header"><span class="badge">Final</span><h2>Finales L√∂sungswort</h2></div>
    <p>
      Wenn ihr alle Zeichen gesammelt habt, k√∂nnt ihr hier das
      <strong>komplette L√∂sungswort</strong> eingeben:
    </p>

    <input id="final-input" type="text" placeholder="L√∂sungswort eingeben">
    <button id="final-btn">Pr√ºfen</button>
    <div id="final-msg" class="message"></div>
  </div>

  <!-- N√§chstes R√§tsel Box -->
  <div class="card" id="next-unlock-card">
    <div class="card-header">
      <span class="badge">Info</span>
      <h2>N√§chstes R√§tsel</h2>
    </div>

    <div id="next-unlock-text">Lade...</div>
    <div id="next-unlock-countdown"></div>
  </div>

  <!-- Fortschritt-Reset -->
  <button id="reset-progress">Fortschritt zur√ºcksetzen</button>

</div> <!-- END CONTAINER -->

<!-- ============ JAVASCRIPT FOLGT IN TEIL 3 ============ -->
<script>
/* Countdown ohne 0-Werte */
function formatDiff(diff){
  const d=Math.floor(diff/86400000);
  const h=Math.floor((diff%86400000)/3600000);
  const m=Math.floor((diff%3600000)/60000);
  const s=Math.floor((diff%60000)/1000);

  const arr=[];
  if(d>0) arr.push(d+"T");
  if(h>0) arr.push(h+"h");
  if(m>0) arr.push(m+"m");
  if(s>0) arr.push(s+"s");

  return arr.length ? arr.join(" ") : "0s";
}

/* GRO√üER Countdown oben */
function updateCountdown(){
  const target=new Date("December 28, 2025 20:00:00").getTime();
  const diff=target-Date.now();
  const el=document.getElementById("countdown");

  if(diff<=0){
    el.textContent="Es ist so weit! üéÑ";
    return;
  }
  el.textContent=formatDiff(diff);
}
updateCountdown();
setInterval(updateCountdown,1000);

/* Unlock-Zeiten */
const unlockSchedule={
  0:new Date("December 1, 2025 18:00:00").getTime(),
  1:new Date("December 8, 2025 18:00:00").getTime(),
  2:new Date("December 10, 2025 18:00:00").getTime(),
  3:new Date("December 16, 2025 18:00:00").getTime(),
  4:new Date("December 22, 2025 18:00:00").getTime(),
  5:new Date("December 28, 2025 20:00:00").getTime(),
};

function isUnlocked(i){
  return ADMIN_MODE || Date.now()>=unlockSchedule[i];
}

/* Speicher */
let progress=JSON.parse(localStorage.getItem("XMASRIDDLE_GLOBAL")||"{}");
function saveProgress(){
  localStorage.setItem("XMASRIDDLE_GLOBAL",JSON.stringify(progress));
}

let ADMIN_MODE=false;
const ADMIN_PASSWORD="SuperYK2025";

/* Zeichen-Liste */
const lettersSpans=document.getElementById("letters-progress").children;
let nextLetterIndex=0;

function addLetter(ch){
  if(nextLetterIndex<lettersSpans.length){
    lettersSpans[nextLetterIndex].textContent=ch;
    lettersSpans[nextLetterIndex].classList.add("filled");
    nextLetterIndex++;
  }
}

/* Puzzle-Karten */
const puzzleCards=document.querySelectorAll(".puzzle-card");

/* QUIZ-Logik */
const quizRows=document.querySelectorAll("#puzzle-0 .question-row");
const quizSummary=document.getElementById("quiz-summary");
let quizSolvedCount=0;

quizRows.forEach(row=>{
  const input=row.querySelector("input[type=text]");
  const radios=row.querySelectorAll("input[type=radio]");
  const btn=row.querySelector("button");
  const msg=row.querySelector(".message");
  const disp=row.querySelector(".letter-display");

  const solution=row.dataset.solution.toLowerCase();
  const letter=row.dataset.letter;

  btn.addEventListener("click",()=>{
    playClick();

    let val="";

    if(input) val=input.value.trim().toLowerCase();
    if(radios.length){
      const r=[...radios].find(r=>r.checked);
      if(r) val=r.value.trim().toLowerCase();
    }

    if(!val){
      msg.textContent="Bitte etwas eingeben.";
      msg.className="message error";
      playError();
      return;
    }

    if(val===solution){

      if(row.dataset.solved==="true"){
        msg.textContent="Schon gel√∂st!";
        msg.className="message success";
        return;
      }

      row.dataset.solved="true";
      msg.textContent="Korrekt!";
      msg.className="message success";
      playSuccess();

      if(input) input.disabled=true;
      radios.forEach(r=>r.disabled=true);
      btn.disabled=true;

      disp.classList.remove("hidden");
      disp.innerHTML=`Zeichen: <span class="letter-badge">${letter}</span>`;

      progress.solvedQuiz ||= [];
      progress.solvedQuiz.push(solution);

      progress.letters ||= [];
      progress.letters.push(letter);
      addLetter(letter);

      quizSolvedCount++;
      saveProgress();

      quizSummary.textContent=`${quizSolvedCount} von 8 gel√∂st`;
      if(quizSolvedCount===8) quizSummary.textContent="Alle 8 Fragen gel√∂st! üéâ";

      updateVisibility();

    } else {
      msg.textContent="Falsch!";
      msg.className="message error";
      playError();
    }
  });
});

/* Spotify R√§tsel */
document.getElementById("spotify-btn").addEventListener("click",()=>{
  playClick();

  const a=document.getElementById("spotify-1").value.toLowerCase();
  const b=document.getElementById("spotify-2").value.toLowerCase();
  const c=document.getElementById("spotify-3").value.toLowerCase();

  const msg=document.getElementById("spotify-msg");

  if(a==="s" && b==="t" && c==="a"){
    msg.textContent="Korrekt!";
    msg.className="message success";
    playSuccess();

    progress.solvedPuzzles ||= {};
    progress.solvedPuzzles[5]=true;

    progress.letters ||= [];
    ["W","e","i","h"].forEach(l=>{ progress.letters.push(l); addLetter(l); });

    saveProgress();
    updateVisibility();
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});

/* Finale */
document.getElementById("final-btn").addEventListener("click",()=>{
  playClick();

  const val=document.getElementById("final-input").value.trim();
  const msg=document.getElementById("final-msg");

  if(val==="3eryk?2025Weihnachtsedition"){
    msg.textContent="Richtig! üéâ";
    msg.className="message success";
    playSuccess();
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});

/* ADMIN */
document.getElementById("admin-btn").addEventListener("click",()=>{
  playClick();

  const val=document.getElementById("admin-pass").value.trim();
  const msg=document.getElementById("admin-msg");

  if(val===ADMIN_PASSWORD){
    ADMIN_MODE=true;
    msg.textContent="Admin-Modus aktiviert!";
    msg.className="message success";
    playSuccess();
    updateVisibility();
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});

/* Burger-Men√º */
const burgerBtn=document.getElementById("burger-btn");
const sideMenu=document.getElementById("side-menu");
const overlay=document.getElementById("menu-overlay");

function openMenu(){
  burgerBtn.classList.add("burger-open");
  sideMenu.classList.add("active");
  sideMenu.classList.remove("hidden");
  overlay.classList.add("active");
  overlay.classList.remove("hidden");
}

function closeMenu(){
  burgerBtn.classList.remove("burger-open");
  sideMenu.classList.remove("active");
  overlay.classList.remove("active");
  setTimeout(()=>{
    if(!overlay.classList.contains("active")){
      sideMenu.classList.add("hidden");
      overlay.classList.add("hidden");
    }
  },250);
}

burgerBtn.addEventListener("click",()=>{
  playClick();
  sideMenu.classList.contains("active") ? closeMenu() : openMenu();
});

overlay.addEventListener("click",()=>{ playClick(); closeMenu(); });

/* Men√º klicks */
document.querySelectorAll("#side-menu li").forEach(li=>{
  li.addEventListener("click",()=>{
    const target=li.dataset.target;
    const el=document.getElementById(target);

    if(li.classList.contains("locked") && !ADMIN_MODE){
      playError();
      return;
    }

    playClick();
    closeMenu();

    if(el) el.scrollIntoView({behavior:"smooth"});
  });
});

/* Next Unlock Box */
function updateNextUnlockBox(){
  const txt=document.getElementById("next-unlock-text");
  const cd=document.getElementById("next-unlock-countdown");

  for(let i=0;i<=5;i++){
    if(!isUnlocked(i)){
      txt.textContent="R√§tsel "+(i+1);
      const diff=unlockSchedule[i]-Date.now();
      cd.textContent=formatDiff(diff);
      return;
    }
  }

  txt.textContent="Alle R√§tsel sind freigeschaltet!";
  cd.textContent="";
}
setInterval(updateNextUnlockBox,1000);

/* Sichtbarkeit */
function updateVisibility(){

  /* ALLES verstecken */
  puzzleCards.forEach(c=>c.classList.add("hidden"));
  document.getElementById("final-card").classList.add("hidden");

  /* WICHTIG: R√§tsel 1 immer zuerst pr√ºfen */
  if(isUnlocked(0)){
    document.getElementById("puzzle-0").classList.remove("hidden");
  }

  /* Men√º aktualisieren */
  document.querySelectorAll("#side-menu li").forEach(li=>{
    const id=li.dataset.target;
    const el=document.getElementById(id);

    if(ADMIN_MODE || !el.classList.contains("hidden")){
      li.classList.remove("locked");
    } else {
      li.classList.add("locked");
    }
  });

  /* R√§tsel 2‚Äì5 */
  for(let i=1;i<=4;i++){
    if(ADMIN_MODE || (isUnlocked(i) && progress.solvedQuiz && quizSolvedCount===8)){
      puzzleCards[i].classList.remove("hidden");
    }
  }

  /* Spotify */
  if(ADMIN_MODE || (isUnlocked(5) && puzzleCards[4] && !puzzleCards[4].classList.contains("hidden"))){
    document.getElementById("puzzle-5").classList.remove("hidden");
  }

  /* Finale */
  const allSolved=[
    quizSolvedCount===8,
    progress.solvedPuzzles?.[1],
    progress.solvedPuzzles?.[2],
    progress.solvedPuzzles?.[3],
    progress.solvedPuzzles?.[4],
    progress.solvedPuzzles?.[5]
  ].every(Boolean);

  if(allSolved || ADMIN_MODE){
    document.getElementById("final-card").classList.remove("hidden");
  }

  updateNextUnlockBox();
}

/* Restore */
(function restore(){

  /* Zeichen */
  if(progress.letters){
    [...lettersSpans].forEach(s=>{
      s.textContent="_";
      s.classList.remove("filled");
    });

    nextLetterIndex=0;
    progress.letters.forEach(l=>addLetter(l));
  }

  /* Quiz */
  if(progress.solvedQuiz){
    progress.solvedQuiz.forEach(sol=>{
      const row=[...quizRows].find(r=>r.dataset.solution.toLowerCase()===sol);
      if(!row) return;

      row.dataset.solved="true";
      quizSolvedCount++;

      const input=row.querySelector("input[type=text]");
      const radios=row.querySelectorAll("input[type=radio]");
      const btn=row.querySelector("button");
      const disp=row.querySelector(".letter-display");

      if(input) input.disabled=true;
      radios.forEach(r=>r.disabled=true);
      if(btn) btn.disabled=true;

      disp.classList.remove("hidden");
      disp.innerHTML=`Zeichen: <span class="letter-badge">${row.dataset.letter}</span>`;
    });

    quizSummary.textContent=`${quizSolvedCount} von 8 gel√∂st`;
    if(quizSolvedCount===8) quizSummary.textContent="Alle 8 Fragen gel√∂st! üéâ";
  }

  /* Spotify */
  if(progress.solvedPuzzles && progress.solvedPuzzles[5]){
    document.getElementById("spotify-1").disabled=true;
    document.getElementById("spotify-2").disabled=true;
    document.getElementById("spotify-3").disabled=true;
    document.getElementById("spotify-btn").disabled=true;
    document.getElementById("spotify-msg").textContent="Bereits gel√∂st!";
  }

  updateVisibility();
})();

/* Reset */
document.getElementById("reset-progress").addEventListener("click",()=>{
  playClick();
  localStorage.removeItem("XMASRIDDLE_GLOBAL");
  location.reload();
});
</script>

</body>
</html>
