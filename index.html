<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>3eryk? WeihnachtsrÃ¤tsel ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg:#020617;
      --card-bg:rgba(15,23,42,0.9);
      --border:rgba(148,163,184,0.3);
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --accent:#38bdf8;
      --error:#f97373;
      --success:#4ade80;
    }

    body {
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 55%);
      color:var(--text-main);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* Schneeflocken */
    .snowflake {
      position:fixed;
      top:-10px;
      color:#fff;
      opacity:0.8;
      pointer-events:none;
      z-index:5;
      animation:fall linear infinite;
    }
    @keyframes fall { to { transform:translateY(110vh); } }

    .container {
      max-width:900px;
      margin:0 auto;
      padding:32px 16px 64px;
      position:relative;
    }

    .title {
      text-align:center;
      margin-bottom:24px;
    }
    .title h1 {
      margin:0;
      font-size:clamp(1.8rem,3vw,2.4rem);
    }

    /* Countdown */
    #countdown {
      margin-top:16px;
      font-size:2.2rem;
      font-weight:800;
      color:var(--accent);
      text-shadow:0 0 10px rgba(56,189,248,0.7);
      animation:pulseGlow 2.2s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%{transform:scale(1);}
      50%{transform:scale(1.05);}
      100%{transform:scale(1);}
    }

    /* Cards */
    .card {
      background:var(--card-bg);
      border-radius:16px;
      border:1px solid var(--border);
      padding:20px 18px;
      margin-bottom:18px;
      box-shadow:0 18px 40px rgba(0,0,0,0.5);
    }
    .card-header {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .badge {
      font-size:0.75rem;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--text-muted);
    }

    iframe {
      width:100%;
      max-width:600px;
      height:338px;
      margin:0 auto;
      display:block;
      border-radius:12px;
      border:none;
      background:#020617;
    }

    /* Zeichen-Fortschritt */
    .letters-progress {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .letters-progress span {
      width:20px;
      text-align:center;
      padding:3px 0;
      border-radius:6px;
      background:rgba(15,23,42,0.7);
      border:1px solid rgba(148,163,184,0.35);
      font-size:0.9rem;
    }
    .letters-progress span.filled {
      border-color:var(--accent);
    }

    /* Inputs */
    input[type="text"],
    input[type="password"] {
      width:100%;
      padding:10px 14px;
      margin-top:6px;
      font-size:1rem;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.25);
      background:rgba(255,255,255,0.06);
      color:#e5e7eb;
      outline:none;
      transition:0.25s ease;
      box-shadow:0 0 0 rgba(56,189,248,0);
      box-sizing:border-box;
    }
    input:hover {
      border-color:rgba(148,163,184,0.4);
    }
    input:focus {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.45);
      background:rgba(255,255,255,0.10);
    }

    .question-row {
      background:rgba(255,255,255,0.03);
      padding:14px 16px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.15);
      margin-bottom:14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
    }
    .question-row p {
      margin:0 0 6px;
      font-weight:600;
    }

    .message.success {
      color:var(--success);
      margin-top:6px;
    }
    .message.error {
      color:var(--error);
      margin-top:6px;
    }

    .letter-badge {
      padding:2px 6px;
      background:rgba(56,189,248,0.25);
      border-radius:6px;
      border:1px solid rgba(56,189,248,0.4);
      font-weight:700;
    }

    button {
      padding:8px 18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:white;
      background:linear-gradient(90deg,#3b82f6,#a855f7);
      transition:0.2s;
      font-size:0.95rem;
      box-shadow:0 3px 12px rgba(0,0,0,0.3);
      margin-top:6px;
    }
    button:hover {
      transform:scale(1.04);
    }
    button:disabled {
      opacity:0.6;
      cursor:not-allowed;
    }

    .hidden {
      display:none !important;
    }

    #reset-progress {
      background:linear-gradient(90deg,#ef4444,#f97316);
      margin-top:32px;
      width:220px;
      display:block;
      margin-left:auto;
      margin-right:auto;
    }

    #next-unlock-countdown {
      margin-top:8px;
      font-size:1.4rem;
      font-weight:700;
      color:var(--accent);
      text-shadow:0 0 12px rgba(56,189,248,0.5);
    }

    /* === BURGER-MENÃœ === */
    .burger-btn {
      position:absolute;
      top:16px;
      right:16px;
      width:42px;
      height:42px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,0.7);
      transition:0.2s;
      z-index:20;
    }
    .burger-btn:hover {
      transform:scale(1.05);
      border-color:var(--accent);
      box-shadow:0 0 18px rgba(56,189,248,0.6);
    }
    .burger-lines {
      width:18px;
      height:14px;
      position:relative;
    }
    .burger-lines span {
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:#e5e7eb;
      border-radius:999px;
      transition:0.25s;
    }
    .burger-lines span:nth-child(1){ top:0; }
    .burger-lines span:nth-child(2){ top:6px; }
    .burger-lines span:nth-child(3){ top:12px; }

    .burger-open .burger-lines span:nth-child(1){
      transform:translateY(6px) rotate(45deg);
    }
    .burger-open .burger-lines span:nth-child(2){
      opacity:0;
    }
    .burger-open .burger-lines span:nth-child(3){
      transform:translateY(-6px) rotate(-45deg);
    }

    .menu-overlay {
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.75);
      backdrop-filter:blur(4px);
      z-index:30;
      opacity:0;
      pointer-events:none;
      transition:opacity 0.25s;
    }
    .menu-overlay.active {
      opacity:1;
      pointer-events:auto;
    }

    .side-menu {
      position:fixed;
      top:0;
      right:0;
      width:260px;
      max-width:80%;
      height:100vh;
      background:rgba(15,23,42,0.98);
      border-left:1px solid rgba(148,163,184,0.4);
      box-shadow:-16px 0 30px rgba(0,0,0,0.7);
      transform:translateX(100%);
      transition:transform 0.25s ease-out;
      z-index:40;
      padding:20px 18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .side-menu.active {
      transform:translateX(0);
    }
    .side-menu h3 {
      margin:0 0 10px;
      font-size:1.1rem;
    }
    .side-menu ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .side-menu li {
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
      font-size:0.95rem;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(15,23,42,0.9);
      transition:0.2s;
    }
    .side-menu li span.label {
      flex:1;
    }
    .side-menu li span.tag {
      font-size:0.7rem;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      color:var(--text-muted);
      margin-left:8px;
    }
    .side-menu li:hover {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.7);
      transform:translateX(-2px);
    }
    .side-menu li.locked {
      opacity:0.45;
      cursor:not-allowed;
      box-shadow:none;
      border-style:dashed;
    }
    .side-menu li.locked:hover {
      transform:none;
      border-color:rgba(148,163,184,0.35);
      box-shadow:none;
    }
  </style>
</head>
<body>

<!-- Schneefall -->
<script>
function createSnowflake(){
  const s=document.createElement("div");
  s.className="snowflake";
  s.textContent="â„";
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=10+Math.random()*18+"px";
  s.style.animationDuration=4+Math.random()*6+"s";
  s.style.opacity=0.4+Math.random()*0.4;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),11000);
}
setInterval(createSnowflake,200);
</script>

<!-- Audio / Click-Sounds -->
<script>
let audioCtx=null;
function getAudioCtx(){
  if(!audioCtx){
    const C=window.AudioContext||window.webkitAudioContext;
    if(C) audioCtx=new C();
  }
  return audioCtx;
}
function playTone(f,d,t="sine",v=0.12){
  const c=getAudioCtx(); if(!c) return;
  const o=c.createOscillator(), g=c.createGain();
  o.type=t; o.frequency.value=f; g.gain.value=v;
  o.connect(g); g.connect(c.destination);
  const n=c.currentTime;
  o.start(n); o.stop(n+d);
  g.gain.setValueAtTime(v,n);
  g.gain.linearRampToValueAtTime(0,n+d);
}
const playClick=()=>playTone(650,0.07,"triangle",0.1);
const playSuccess=()=>{ playTone(880,0.1); setTimeout(()=>playTone(1040,0.1),90); };
const playError=()=>playTone(220,0.14,"square",0.12);
</script>

<!-- Overlay & Side Menu -->
<div id="menu-overlay" class="menu-overlay hidden"></div>
<nav id="side-menu" class="side-menu hidden">
  <h3>Navigation</h3>
  <ul>
    <li data-target="puzzle-0"><span class="label">RÃ¤tsel 1 â€“ Quiz</span><span class="tag">Start</span></li>
    <li data-target="puzzle-1"><span class="label">RÃ¤tsel 2</span></li>
    <li data-target="puzzle-2"><span class="label">RÃ¤tsel 3</span></li>
    <li data-target="puzzle-3"><span class="label">RÃ¤tsel 4</span></li>
    <li data-target="puzzle-4"><span class="label">RÃ¤tsel 5</span></li>
    <li data-target="puzzle-5"><span class="label">RÃ¤tsel 6 â€“ Spotify</span></li>
    <li data-target="final-card"><span class="label">Finales LÃ¶sungswort</span><span class="tag">Finale</span></li>
  </ul>
</nav>

<div class="container">
  <!-- Burger Button oben rechts -->
  <button id="burger-btn" class="burger-btn" type="button">
    <div class="burger-lines">
      <span></span><span></span><span></span>
    </div>
  </button>

  <div class="title">
    <h1>ðŸŽ„ 3eryk? WeihnachtsrÃ¤tsel â€“ 2025 Edition ðŸŽ„</h1>
    <div id="countdown">Lade Countdown...</div>
  </div>

  <!-- ADMIN LOGIN -->
  <div class="card">
    <div class="card-header">
      <span class="badge">Admin</span><h2>Admin Login</h2>
    </div>
    <p>Passwort eingeben, um alles freizuschalten:</p>
    <input id="admin-pass" type="password" placeholder="Passwort">
    <button id="admin-btn">Login</button>
    <div id="admin-msg" class="message"></div>
  </div>

  <!-- INTRO -->
  <div class="card">
    <div class="card-header">
      <span class="badge">Intro</span><h2>Willkommen!</h2>
    </div>
    <iframe
      src="https://www.youtube.com/embed/TGvnbko2Jio?si=z0f59smM_qRPTszH"
      allowfullscreen
    ></iframe>
  </div>

  <!-- Fortschritt -->
  <div class="card">
    <div class="card-header">
      <span class="badge">Fortschritt</span><h2>Gesammelte Zeichen</h2>
    </div>
    <div class="letters-progress" id="letters-progress">
      <!-- 29 Slots -->
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span>
    </div>
  </div>

  <!-- RÃ¤tsel 1 â€“ Quiz -->
  <div class="card puzzle-card" id="puzzle-0" data-index="0">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 1</span><h2>Quiz â€“ 8 Fragen</h2>
    </div>
    <div id="quiz-summary" class="message">0 von 8 gelÃ¶st</div>

    <!-- Frage 1 -->
    <div class="question-row" data-solution="3" data-letter="3">
      <p>1. Aus wie vielen Alben besteht die Trilogie von TheWeeknd?</p>
      <input type="text" placeholder="Zahl eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 2 -->
    <div class="question-row" data-solution="25.09.2024" data-letter="e">
      <p>2. Wann war der erste Call in der Discord Gruppe 3eryk?</p>
      <label><input type="radio" name="f2" value="10.08.2024"> 10.08.2024</label><br>
      <label><input type="radio" name="f2" value="25.09.2024"> 25.09.2024</label><br>
      <label><input type="radio" name="f2" value="01.10.2024"> 01.10.2024</label><br>
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 3 -->
    <div class="question-row" data-solution="rot ist meine lieblings zahl im ganzen alphabet" data-letter="r">
      <p>3. Rot....?</p>
      <input type="text" placeholder="ganzen Satz eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 4 -->
    <div class="question-row" data-solution="wann" data-letter="y">
      <p>4. Frage...?</p>
      <input type="text" placeholder="Antwort eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>
    <!-- Frage 5 -->
    <div class="question-row" data-solution="i" data-letter="?">
      <p>5. Welche Endung ist die schÃ¶nste?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 6 -->
    <div class="question-row" data-solution="t" data-letter="2">
      <p>6. Firo's aktueller Lieblingsbuchstabe?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 7 -->
    <div class="question-row" data-solution="e" data-letter="0">
      <p>7. Welcher Buchstabe ist der weitverbreitetste in Namen?</p>
      <input type="text" placeholder="Buchstabe eingeben">
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

    <!-- Frage 8 -->
    <div class="question-row" data-solution="47" data-letter="2">
      <p>8. Wie viele Medien wurden geteilt?</p>
      <label><input type="radio" name="f8" value="23"> 23</label><br>
      <label><input type="radio" name="f8" value="69"> 69</label><br>
      <label><input type="radio" name="f8" value="83"> 83</label><br>
      <label><input type="radio" name="f8" value="47"> 47</label><br>
      <button>PrÃ¼fen</button>
      <div class="message"></div>
      <div class="letter-display hidden"></div>
    </div>

  </div><!-- Ende RÃ¤tsel 1 -->


  <!-- RÃ„TSEL 2 -->
  <div class="card puzzle-card hidden" id="puzzle-1" data-index="1" data-solution="r2" data-letters="r,n,c,h">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 2</span><h2>RÃ¤tsel 2</h2>
    </div>
    <input type="text" placeholder="Antwort eingeben">
    <button>PrÃ¼fen</button>
    <div class="message"></div>
    <div class="letter-display hidden"></div>
  </div>

  <!-- RÃ„TSEL 3 -->
  <div class="card puzzle-card hidden" id="puzzle-2" data-index="2" data-solution="r3" data-letters="k,0,5,W">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 3</span><h2>RÃ¤tsel 3</h2>
    </div>
    <input type="text" placeholder="Antwort eingeben">
    <button>PrÃ¼fen</button>
    <div class="message"></div>
    <div class="letter-display hidden"></div>
  </div>

  <!-- RÃ„TSEL 4 -->
  <div class="card puzzle-card hidden" id="puzzle-3" data-index="3" data-solution="r4" data-letters="e,h,a,s">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 4</span><h2>RÃ¤tsel 4</h2>
    </div>
    <input type="text" placeholder="Antwort eingeben">
    <button>PrÃ¼fen</button>
    <div class="message"></div>
    <div class="letter-display hidden"></div>
  </div>

  <!-- RÃ„TSEL 5 -->
  <div class="card puzzle-card hidden" id="puzzle-4" data-index="4" data-solution="r5" data-letters="e,i,t,i">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 5</span><h2>RÃ¤tsel 5</h2>
    </div>
    <input type="text" placeholder="Antwort eingeben">
    <button>PrÃ¼fen</button>
    <div class="message"></div>
    <div class="letter-display hidden"></div>
  </div>


  <!-- RÃ„TSEL 6 â€“ SPOTIFY -->
  <div class="card puzzle-card hidden" id="puzzle-5" data-index="5">
    <div class="card-header">
      <span class="badge">RÃ¤tsel 6</span><h2>Spotify â€“ SÃ£o Paulo</h2>
    </div>

    <p>Gib die drei Buchstaben aus dem Song ein: <b>S â€“ T â€“ A</b></p>

    <div style="display:flex; gap:10px; margin-bottom:12px;">
      <input id="spotify-1" maxlength="1" placeholder="S">
      <input id="spotify-2" maxlength="1" placeholder="T">
      <input id="spotify-3" maxlength="1" placeholder="A">
    </div>

    <button id="spotify-check">PrÃ¼fen</button>
    <div id="spotify-msg" class="message"></div>
    <div id="spotify-letters" class="letter-display hidden"></div>
  </div>


  <!-- FINALES RÃ„TSEL -->
  <div class="card hidden" id="final-card">
    <div class="card-header">
      <span class="badge">Finale</span><h2>LÃ¶sungswort eingeben</h2>
    </div>

    <input id="final-input" placeholder="3eryk?2025Weihnachtsedition">
    <button id="final-button">PrÃ¼fen</button>
    <div id="final-message" class="message"></div>

    <div id="final-video-wrapper" class="hidden" style="margin-top:16px;">
      <p>ðŸŽ‰ GlÃ¼ckwunsch! ðŸŽ‰</p>
      <iframe
        src="https://www.youtube.com/embed/TGvnbko2Jio?si=z0f59smM_qRPTszH"
        allowfullscreen
      ></iframe>
    </div>
  </div>

  <!-- NEXT UNLOCK -->
  <div class="card" id="next-unlock-card">
    <div class="card-header">
      <span class="badge">Info</span><h2>NÃ¤chstes RÃ¤tsel</h2>
    </div>
    <p id="next-unlock-text">Ladeâ€¦</p>
    <div id="next-unlock-countdown">â€¦</div>
  </div>

  <!-- RESET -->
  <button id="reset-progress">ðŸ”„ Fortschritt zurÃ¼cksetzen</button>

</div><!-- container END -->

<!-- BEGINN JAVASCRIPT -->
<script>

/* TIME FORMATTER â€“ keine 0-Einheiten */
function formatDiff(diff){
  const d=Math.floor(diff/86400000);
  const h=Math.floor((diff%86400000)/3600000);
  const m=Math.floor((diff%3600000)/60000);
  const s=Math.floor((diff%60000)/1000);

  let parts=[];
  if(d>0) parts.push(d+"T");
  if(h>0) parts.push(h+"h");
  if(m>0) parts.push(m+"m");
  if(s>0) parts.push(s+"s");

  return parts.length ? parts.join(" ") : "0s";
}

/* COUNTDOWN Haupttimer */
function updateCountdown(){
  const target=new Date("December 28, 2025 20:00:00").getTime();
  const now=Date.now();
  const diff=target-now;
  const el=document.getElementById("countdown");

  if(diff<=0){
    el.textContent="Es ist so weit! ðŸŽ„";
    return;
  }

  el.textContent=formatDiff(diff);
}

updateCountdown();
setInterval(updateCountdown,1000);


/* UNLOCK-ZEITEN */
const unlockSchedule={
  0:new Date("December 1, 2025 18:00:00").getTime(),
  1:new Date("December 8, 2025 18:00:00").getTime(),
  2:new Date("December 10, 2025 18:00:00").getTime(),
  3:new Date("December 16, 2025 18:00:00").getTime(),
  4:new Date("December 22, 2025 18:00:00").getTime(),
  5:new Date("December 28, 2025 20:00:00").getTime()
};

let ADMIN_MODE=false;
const ADMIN_PASSWORD="SuperYK2025";

function isUnlocked(i){
  return ADMIN_MODE || Date.now()>=unlockSchedule[i];
}


/* Speicher */
let progress=JSON.parse(localStorage.getItem("XMASRIDDLE_GLOBAL")||"{}");
function saveProgress(){ localStorage.setItem("XMASRIDDLE_GLOBAL",JSON.stringify(progress)); }


/* Zeichen-Slots */
const lettersSpans=document.getElementById("letters-progress").children;
let nextLetterIndex=0;

function addLetter(ch){
  if(nextLetterIndex<lettersSpans.length){
    lettersSpans[nextLetterIndex].textContent=ch;
    lettersSpans[nextLetterIndex].classList.add("filled");
    nextLetterIndex++;
  }
}


/* RÃ¤tsel Karten */
const puzzleCards=document.querySelectorAll(".puzzle-card");


/* QUIZ-LOGIK â€“ RÃ¤tsel 1 */
const quizRows=document.querySelectorAll("#puzzle-0 .question-row");
const quizSummary=document.getElementById("quiz-summary");
let quizSolvedCount=0;

quizRows.forEach(row=>{
  const input=row.querySelector("input[type=text]");
  const radios=row.querySelectorAll("input[type=radio]");
  const button=row.querySelector("button");
  const msg=row.querySelector(".message");
  const disp=row.querySelector(".letter-display");

  const solution=row.dataset.solution.toLowerCase();
  const letter=row.dataset.letter;

  button.addEventListener("click",()=>{
    playClick();

    let answer="";
    if(radios.length){
      const r=[...radios].find(x=>x.checked);
      if(r) answer=r.value.toLowerCase();
    } else if(input){
      answer=input.value.trim().toLowerCase();
    }

    if(!answer){
      msg.textContent="Bitte etwas eingeben.";
      msg.className="message error";
      playError();
      return;
    }

    if(answer===solution){
      if(row.dataset.solved==="true"){
        msg.textContent="Schon gelÃ¶st.";
        msg.className="message success";
        return;
      }

      row.dataset.solved="true";

      if(input) input.disabled=true;
      radios.forEach(r=>r.disabled=true);
      button.disabled=true;

      msg.textContent="Korrekt!";
      msg.className="message success";
      playSuccess();

      disp.classList.remove("hidden");
      disp.innerHTML=`Zeichen: <span class="letter-badge">${letter}</span>`;

      progress.letters ||= [];
      progress.letters.push(letter);

      progress.solvedQuiz ||= [];
      progress.solvedQuiz.push(solution);

      saveProgress();
      addLetter(letter);

      quizSolvedCount++;
      quizSummary.textContent=`${quizSolvedCount} von 8 gelÃ¶st`;

      if(quizSolvedCount===8){
        quizSummary.textContent="Alle 8 Fragen gelÃ¶st! ðŸŽ‰";
        progress.solvedPuzzles ||= {};
        progress.solvedPuzzles[0]=true;
        saveProgress();
        updateVisibility();
      }
    } else {
      msg.textContent="Falsch!";
      msg.className="message error";
      playError();
    }
  });
});
/* RÃ„TSEL 2â€“5 */
puzzleCards.forEach(card=>{
  const idx=parseInt(card.dataset.index);
  const sol=card.dataset.solution;
  const letters=card.dataset.letters ? card.dataset.letters.split(",") : [];

  const input=card.querySelector("input[type=text]");
  const btn=card.querySelector("button");
  const msg=card.querySelector(".message");
  const disp=card.querySelector(".letter-display");

  if(!input || !btn) return;

  btn.addEventListener("click",()=>{
    playClick();

    const val=input.value.trim().toLowerCase();
    if(!val){
      msg.textContent="Bitte etwas eingeben.";
      msg.className="message error";
      playError();
      return;
    }

    if(val===sol){
      if(progress.solvedPuzzles && progress.solvedPuzzles[idx]){
        msg.textContent="Bereits gelÃ¶st.";
        msg.className="message success";
        return;
      }

      msg.textContent="Korrekt!";
      msg.className="message success";
      playSuccess();

      input.disabled=true;
      btn.disabled=true;

      disp.classList.remove("hidden");
      disp.textContent="Zeichen: " + letters.join(", ");

      progress.solvedPuzzles ||= {};
      progress.solvedPuzzles[idx]=true;

      progress.letters ||= [];
      letters.forEach(l=>{
        progress.letters.push(l);
        addLetter(l);
      });

      saveProgress();
      updateVisibility();

    } else {
      msg.textContent="Falsch!";
      msg.className="message error";
      playError();
    }
  });
});


/* SPOTIFY RÃ„TSEL */
document.getElementById("spotify-check").addEventListener("click",()=>{
  playClick();

  const a = document.getElementById("spotify-1").value.toLowerCase();
  const b = document.getElementById("spotify-2").value.toLowerCase();
  const c = document.getElementById("spotify-3").value.toLowerCase();

  const msg=document.getElementById("spotify-msg");
  const disp=document.getElementById("spotify-letters");

  if(a==="s" && b==="t" && c==="a"){
    if(progress.solvedPuzzles && progress.solvedPuzzles[5]){
      msg.textContent="Schon gelÃ¶st.";
      msg.className="message success";
      return;
    }

    msg.textContent="Korrekt!";
    msg.className="message success";
    playSuccess();

    document.getElementById("spotify-1").disabled=true;
    document.getElementById("spotify-2").disabled=true;
    document.getElementById("spotify-3").disabled=true;
    document.getElementById("spotify-check").disabled=true;

    const letters=["W","e","i","h"];
    disp.classList.remove("hidden");
    disp.textContent="Zeichen: W, e, i, h";

    progress.solvedPuzzles ||= {};
    progress.solvedPuzzles[5]=true;

    progress.letters ||= [];
    letters.forEach(l=>{
      progress.letters.push(l);
      addLetter(l);
    });

    saveProgress();
    updateVisibility();
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});


/* FINALES RÃ„TSEL */
document.getElementById("final-button").addEventListener("click",()=>{
  playClick();

  const val=document.getElementById("final-input").value.trim();
  const msg=document.getElementById("final-message");

  if(val==="3eryk?2025Weihnachtsedition"){
    msg.textContent="Richtig! ðŸŽ‰";
    msg.className="message success";
    playSuccess();

    document.getElementById("final-video-wrapper").classList.remove("hidden");
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});


/* BURGER-MENÃœ */
const burgerBtn=document.getElementById("burger-btn");
const sideMenu=document.getElementById("side-menu");
const overlay=document.getElementById("menu-overlay");

function openMenu(){
  burgerBtn.classList.add("burger-open");
  sideMenu.classList.add("active");
  overlay.classList.add("active");
  sideMenu.classList.remove("hidden");
  overlay.classList.remove("hidden");
}

function closeMenu(){
  burgerBtn.classList.remove("burger-open");
  sideMenu.classList.remove("active");
  overlay.classList.remove("active");
  setTimeout(()=>{
    if(!overlay.classList.contains("active")){
      sideMenu.classList.add("hidden");
      overlay.classList.add("hidden");
    }
  },250);
}

burgerBtn.addEventListener("click",()=>{
  playClick();
  if(sideMenu.classList.contains("active")){
    closeMenu();
  } else {
    openMenu();
  }
});

overlay.addEventListener("click",()=>{
  playClick();
  closeMenu();
});


/* MENÃœ NAVIGATION */
document.querySelectorAll("#side-menu li").forEach(li=>{
  li.addEventListener("click",()=>{
    const targetId=li.dataset.target;
    const el=document.getElementById(targetId);

    if(li.classList.contains("locked") && !ADMIN_MODE){
      playError();
      return;
    }

    playClick();
    closeMenu();

    if(el){
      el.scrollIntoView({behavior:"smooth"});
    }
  });
});


/* VISIBILITY UPDATE */
function updateVisibility(){
  const cards=document.querySelectorAll(".puzzle-card");
  cards.forEach(c=>c.classList.add("hidden"));
  document.getElementById("final-card").classList.add("hidden");

  /* MENU UPDATE */
  const menuItems=document.querySelectorAll("#side-menu li");
  menuItems.forEach((li)=>{
    const id=li.dataset.target;
    const el=document.getElementById(id);

    if(ADMIN_MODE || !el.classList.contains("hidden")){
      li.classList.remove("locked");
    } else {
      li.classList.add("locked");
    }
  });

  /* RÃ„TSEL 1 */
  if(isUnlocked(0)) document.getElementById("puzzle-0").classList.remove("hidden");

  /* RÃ„TSEL 2â€“5 */
  for(let i=1;i<=4;i++){
    const prevSolved=progress.solvedPuzzles && progress.solvedPuzzles[i-1];
    if(ADMIN_MODE || (isUnlocked(i) && prevSolved)){
      puzzleCards[i].classList.remove("hidden");
    }
  }

  /* SPOTIFY */
  if(ADMIN_MODE || (isUnlocked(5) && progress.solvedPuzzles && progress.solvedPuzzles[4])){
    document.getElementById("puzzle-5").classList.remove("hidden");
  }

  /* FINALE */
  const allSolved=[0,1,2,3,4,5].every(x=>progress.solvedPuzzles && progress.solvedPuzzles[x]);
  if(allSolved || ADMIN_MODE){
    document.getElementById("final-card").classList.remove("hidden");
  }

  updateNextUnlockBox();
}


/* NEXT UNLOCK BOX */
function updateNextUnlockBox(){
  const text=document.getElementById("next-unlock-text");
  const cd=document.getElementById("next-unlock-countdown");

  for(let i=0;i<=5;i++){
    if(!isUnlocked(i)){
      const diff=unlockSchedule[i]-Date.now();
      text.textContent=`RÃ¤tsel ${i+1}`;
      cd.textContent=formatDiff(diff);
      return;
    }
  }

  text.textContent="Alle RÃ¤tsel sind freigeschaltet!";
  cd.textContent="";
}

setInterval(updateNextUnlockBox,1000);


/* ADMIN LOGIN */
document.getElementById("admin-btn").addEventListener("click",()=>{
  playClick();
  const val=document.getElementById("admin-pass").value.trim();
  const msg=document.getElementById("admin-msg");

  if(val===ADMIN_PASSWORD){
    ADMIN_MODE=true;
    msg.textContent="Admin-Modus aktiviert!";
    msg.className="message success";
    playSuccess();
    updateVisibility();
  } else {
    msg.textContent="Falsch!";
    msg.className="message error";
    playError();
  }
});


/* RESTORE PROGRESS */
(function restore(){
  if(progress.letters){
    nextLetterIndex=0;
    lettersSpans.forEach(s=>{
      s.textContent="_";
      s.classList.remove("filled");
    });

    progress.letters.forEach(l=>{
      addLetter(l);
    });
  }

  if(progress.solvedQuiz){
    quizRows.forEach(row=>{
      const sol=row.dataset.solution.toLowerCase();
      if(progress.solvedQuiz.includes(sol)){
        row.dataset.solved="true";
        quizSolvedCount++;
        row.querySelector("button").disabled=true;

        const input=row.querySelector("input[type=text]");
        if(input) input.disabled=true;

        const radios=row.querySelectorAll("input[type=radio]");
        radios.forEach(r=>r.disabled=true);

        const disp=row.querySelector(".letter-display");
        disp.classList.remove("hidden");
        disp.innerHTML=`Zeichen: <span class="letter-badge">${row.dataset.letter}</span>`;
      }
    });

    quizSummary.textContent=`${quizSolvedCount} von 8 gelÃ¶st`;
    if(quizSolvedCount===8) quizSummary.textContent="Alle 8 Fragen gelÃ¶st! ðŸŽ‰";
  }

  if(progress.solvedPuzzles){
    for(let i=1;i<=4;i++){
      if(progress.solvedPuzzles[i]){
        const card=puzzleCards[i];
        const input=card.querySelector("input[type=text]");
        const btn=card.querySelector("button");
        const disp=card.querySelector(".letter-display");

        if(input) input.disabled=true;
        if(btn) btn.disabled=true;

        if(card.dataset.letters){
          disp.classList.remove("hidden");
          disp.textContent="Zeichen: "+card.dataset.letters;
        }
      }
    }
  }

  if(progress.solvedPuzzles && progress.solvedPuzzles[5]){
    document.getElementById("spotify-1").disabled=true;
    document.getElementById("spotify-2").disabled=true;
    document.getElementById("spotify-3").disabled=true;
    document.getElementById("spotify-check").disabled=true;
    document.getElementById("spotify-letters").classList.remove("hidden");
    document.getElementById("spotify-letters").textContent="Zeichen: W, e, i, h";
  }

  updateVisibility();
})();


/* RESET */
document.getElementById("reset-progress").addEventListener("click",()=>{
  playClick();
  localStorage.removeItem("XMASRIDDLE_GLOBAL");
  location.reload();
});

</script>

</body>
</html>
