<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>3eryk? WeihnachtsrÃ¤tsel ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg:#020617;
      --card-bg:rgba(15,23,42,0.9);
      --border:rgba(148,163,184,0.3);
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --accent:#38bdf8;
      --error:#f97373;
      --success:#4ade80;
    }

    body {
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 55%);
      color:var(--text-main);
      min-height:100vh;
      overflow-x:hidden;
    }

    .snowflake {
      position:fixed;
      top:-10px;
      color:#fff;
      opacity:0.8;
      pointer-events:none;
      z-index:5;
      animation:fall linear infinite;
    }
    @keyframes fall { to { transform:translateY(110vh); } }

    .container {
      max-width:900px;
      margin:0 auto;
      padding:32px 16px 64px;
      position:relative;
    }

    .title {
      text-align:center;
      margin-bottom:24px;
    }
    .title h1 {
      margin:0;
      font-size:clamp(1.8rem,3vw,2.4rem);
    }

    #countdown {
      margin-top:16px;
      font-size:2.2rem;
      font-weight:800;
      color:var(--accent);
      text-shadow:0 0 10px rgba(56,189,248,0.7);
      animation:pulseGlow 2.2s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%{transform:scale(1);}
      50%{transform:scale(1.05);}
      100%{transform:scale(1);}
    }

    .card {
      background:var(--card-bg);
      border-radius:16px;
      border:1px solid var(--border);
      padding:20px 18px;
      margin-bottom:18px;
      box-shadow:0 18px 40px rgba(0,0,0,0.5);
    }
    .card-header {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .badge {
      font-size:0.75rem;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--text-muted);
    }

    iframe {
      width:100%;
      max-width:600px;
      height:338px;
      margin:0 auto;
      display:block;
      border-radius:12px;
      border:none;
      background:#020617;
    }

    .letters-progress {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .letters-progress span {
      width:20px;
      text-align:center;
      padding:3px 0;
      border-radius:6px;
      background:rgba(15,23,42,0.7);
      border:1px solid rgba(148,163,184,0.35);
      font-size:0.9rem;
    }
    .letters-progress span.filled {
      border-color:var(--accent);
    }

    input[type="text"],
    input[type="password"] {
      width:100%;
      padding:10px 14px;
      margin-top:6px;
      font-size:1rem;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.25);
      background:rgba(255,255,255,0.06);
      color:#e5e7eb;
      outline:none;
      transition:0.25s ease;
      box-sizing:border-box;
    }
    input:hover {
      border-color:rgba(148,163,184,0.4);
    }
    input:focus {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.45);
      background:rgba(255,255,255,0.10);
    }

    .question-row {
      background:rgba(255,255,255,0.03);
      padding:14px 16px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.15);
      margin-bottom:14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
    }
    .question-row p {
      margin:0 0 6px;
      font-weight:600;
    }

    .message.success { color:var(--success); margin-top:6px; }
    .message.error { color:var(--error); margin-top:6px; }

    button {
      padding:8px 18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:white;
      background:linear-gradient(90deg,#3b82f6,#a855f7);
      transition:0.2s;
      font-size:0.95rem;
      margin-top:6px;
      box-shadow:0 3px 12px rgba(0,0,0,0.3);
    }
    button:hover { transform:scale(1.04); }
    button:disabled { opacity:0.6; cursor:not-allowed; }

    .hidden { display:none !important; }

    #reset-progress {
      background:linear-gradient(90deg,#ef4444,#f97316);
      margin-top:32px;
      width:220px;
      display:block;
      margin-left:auto;
      margin-right:auto;
    }

    /* BURGER MENU */
    .burger-btn {
      position:fixed;
      top:10px;
      right:10px;
      width:46px;
      height:46px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,0.7);
      transition:0.2s;
      z-index:50;
    }
    .burger-btn:hover {
      transform:scale(1.08);
      border-color:var(--accent);
      box-shadow:0 0 18px rgba(56,189,248,0.6);
    }

    .burger-lines {
      width:20px;
      height:16px;
      position:relative;
    }
    .burger-lines span {
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:#e5e7eb;
      border-radius:999px;
      transition:0.25s;
    }
    .burger-lines span:nth-child(1){ top:0; }
    .burger-lines span:nth-child(2){ top:7px; }
    .burger-lines span:nth-child(3){ top:14px; }

    .menu-overlay {
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.75);
      backdrop-filter:blur(4px);
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s;
    }
    .menu-overlay.active {
      opacity:1;
      pointer-events:auto;
    }

    .side-menu {
      position:fixed;
      top:0; right:0;
      width:260px;
      max-width:85%;
      height:100vh;
      background:rgba(15,23,42,0.98);
      border-left:1px solid rgba(148,163,184,0.4);
      box-shadow:-16px 0 30px rgba(0,0,0,0.7);
      transform:translateX(100%);
      transition:transform .25s ease-out;
      z-index:60;
      padding:20px 18px;
    }
    .side-menu.active { transform:translateX(0); }

    .side-menu ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .side-menu li {
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(20,27,48,0.95);
      transition:.2s;
    }
    .side-menu li.locked {
      opacity:0.4;
      cursor:not-allowed;
      border-style:dashed;
    }
  </style>
</head>

<body>

<script>
function createSnowflake(){
  const s=document.createElement("div");
  s.className="snowflake";
  s.textContent="â„";
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=10+Math.random()*18+"px";
  s.style.animationDuration=4+Math.random()*6+"s";
  s.style.opacity=0.4+Math.random()*0.4;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),11000);
}
setInterval(createSnowflake,200);
</script>

<div id="menu-overlay" class="menu-overlay hidden"></div>

<nav id="side-menu" class="side-menu hidden">
  <h3>Navigation</h3>
  <ul>
    <li data-target="puzzle-0"><span class="label">RÃ¤tsel 1</span><span class="tag">Start</span></li>
    <li data-target="puzzle-1"><span class="label">RÃ¤tsel 2</span></li>
    <li data-target="puzzle-2"><span class="label">RÃ¤tsel 3</span></li>
    <li data-target="puzzle-3"><span class="label">RÃ¤tsel 4</span></li>
    <li data-target="puzzle-4"><span class="label">RÃ¤tsel 5</span></li>
    <li data-target="puzzle-5"><span class="label">RÃ¤tsel 6</span></li>
    <li data-target="final-card"><span class="label">Finale</span></li>
  </ul>
</nav>

<button id="burger-btn" class="burger-btn">
  <div class="burger-lines">
    <span></span><span></span><span></span>
  </div>
</button>

<div class="container">

  <div class="title">
    <h1>ðŸŽ„ 3eryk? WeihnachtsrÃ¤tsel â€“ 2025 Edition ðŸŽ„</h1>
    <div id="countdown">Lade Countdown...</div>
  </div>

  <!-- Admin -->
  <div class="card">
    <div class="card-header"><span class="badge">Admin</span><h2>Admin Login</h2></div>
    <input id="admin-pass" type="password" placeholder="Passwort">
    <button id="admin-btn">Login</button>
    <div id="admin-msg" class="message"></div>
  </div>

  <!-- Intro -->
  <div class="card">
    <div class="card-header"><span class="badge">Intro</span><h2>Willkommen!</h2></div>
    <iframe src="https://www.youtube.com/embed/TGvnbko2Jio?si=z0f59smM_qRPTszH" allowfullscreen></iframe>
  </div>

  <!-- Fortschritt -->
  <div class="card">
    <div class="card-header"><span class="badge">Fortschritt</span><h2>Gesammelte Zeichen</h2></div>
    <div class="letters-progress" id="letters-progress">
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span>
    </div>
  </div>

  <!-- NÃ„CHSTES RÃ„TSEL -->
  <div class="card" id="next-unlock-card">
    <div class="card-header"><span class="badge">Info</span><h2>NÃ¤chstes RÃ¤tsel</h2></div>
    <div id="next-unlock-text">Lade...</div>
    <div id="next-unlock-countdown"></div>
  </div>

  <!-- QR CODE BLOCK -->
  <div class="card" id="qr-hint-card">
    <div class="card-header">
      <span class="badge">QR-Code</span>
      <h2>Zusatzaufgabe</h2>
    </div>
    <p>
      <strong>Findet alle Teile des QR-Codes mithilfe von Firoâ€¦</strong>
    </p>
    <p style="margin-top:10px;color:var(--text-muted);font-size:0.9rem;">
      ðŸ’¡ Es existieren mehrere Teile. Erst zusammensetzen â†’ dann scannen.
    </p>
  </div>
<!doctype html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>3eryk? WeihnachtsrÃ¤tsel ðŸŽ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg:#020617;
      --card-bg:rgba(15,23,42,0.9);
      --border:rgba(148,163,184,0.3);
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --accent:#38bdf8;
      --error:#f97373;
      --success:#4ade80;
    }

    body {
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#1e293b 0,#020617 55%);
      color:var(--text-main);
      min-height:100vh;
      overflow-x:hidden;
    }

    .snowflake {
      position:fixed;
      top:-10px;
      color:#fff;
      opacity:0.8;
      pointer-events:none;
      z-index:5;
      animation:fall linear infinite;
    }
    @keyframes fall { to { transform:translateY(110vh); } }

    .container {
      max-width:900px;
      margin:0 auto;
      padding:32px 16px 64px;
      position:relative;
    }

    .title {
      text-align:center;
      margin-bottom:24px;
    }
    .title h1 {
      margin:0;
      font-size:clamp(1.8rem,3vw,2.4rem);
    }

    #countdown {
      margin-top:16px;
      font-size:2.2rem;
      font-weight:800;
      color:var(--accent);
      text-shadow:0 0 10px rgba(56,189,248,0.7);
      animation:pulseGlow 2.2s ease-in-out infinite;
    }
    @keyframes pulseGlow {
      0%{transform:scale(1);}
      50%{transform:scale(1.05);}
      100%{transform:scale(1);}
    }

    .card {
      background:var(--card-bg);
      border-radius:16px;
      border:1px solid var(--border);
      padding:20px 18px;
      margin-bottom:18px;
      box-shadow:0 18px 40px rgba(0,0,0,0.5);
    }
    .card-header {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .badge {
      font-size:0.75rem;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--text-muted);
    }

    iframe {
      width:100%;
      max-width:600px;
      height:338px;
      margin:0 auto;
      display:block;
      border-radius:12px;
      border:none;
      background:#020617;
    }

    .letters-progress {
      display:flex;
      flex-wrap:wrap;
      gap:6px;
    }
    .letters-progress span {
      width:20px;
      text-align:center;
      padding:3px 0;
      border-radius:6px;
      background:rgba(15,23,42,0.7);
      border:1px solid rgba(148,163,184,0.35);
      font-size:0.9rem;
    }
    .letters-progress span.filled {
      border-color:var(--accent);
    }

    input[type="text"],
    input[type="password"] {
      width:100%;
      padding:10px 14px;
      margin-top:6px;
      font-size:1rem;
      border-radius:10px;
      border:1px solid rgba(148,163,184,0.25);
      background:rgba(255,255,255,0.06);
      color:#e5e7eb;
      outline:none;
      transition:0.25s ease;
      box-sizing:border-box;
    }
    input:hover {
      border-color:rgba(148,163,184,0.4);
    }
    input:focus {
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(56,189,248,0.45);
      background:rgba(255,255,255,0.10);
    }

    .question-row {
      background:rgba(255,255,255,0.03);
      padding:14px 16px;
      border-radius:12px;
      border:1px solid rgba(148,163,184,0.15);
      margin-bottom:14px;
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
    }
    .question-row p {
      margin:0 0 6px;
      font-weight:600;
    }

    .message.success { color:var(--success); margin-top:6px; }
    .message.error { color:var(--error); margin-top:6px; }

    button {
      padding:8px 18px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      color:white;
      background:linear-gradient(90deg,#3b82f6,#a855f7);
      transition:0.2s;
      font-size:0.95rem;
      margin-top:6px;
      box-shadow:0 3px 12px rgba(0,0,0,0.3);
    }
    button:hover { transform:scale(1.04); }
    button:disabled { opacity:0.6; cursor:not-allowed; }

    .hidden { display:none !important; }

    #reset-progress {
      background:linear-gradient(90deg,#ef4444,#f97316);
      margin-top:32px;
      width:220px;
      display:block;
      margin-left:auto;
      margin-right:auto;
    }

    /* BURGER MENU */
    .burger-btn {
      position:fixed;
      top:10px;
      right:10px;
      width:46px;
      height:46px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,0.5);
      background:rgba(15,23,42,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 12px 30px rgba(0,0,0,0.7);
      transition:0.2s;
      z-index:50;
    }
    .burger-btn:hover {
      transform:scale(1.08);
      border-color:var(--accent);
      box-shadow:0 0 18px rgba(56,189,248,0.6);
    }

    .burger-lines {
      width:20px;
      height:16px;
      position:relative;
    }
    .burger-lines span {
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:#e5e7eb;
      border-radius:999px;
      transition:0.25s;
    }
    .burger-lines span:nth-child(1){ top:0; }
    .burger-lines span:nth-child(2){ top:7px; }
    .burger-lines span:nth-child(3){ top:14px; }

    .menu-overlay {
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.75);
      backdrop-filter:blur(4px);
      z-index:40;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s;
    }
    .menu-overlay.active {
      opacity:1;
      pointer-events:auto;
    }

    .side-menu {
      position:fixed;
      top:0; right:0;
      width:260px;
      max-width:85%;
      height:100vh;
      background:rgba(15,23,42,0.98);
      border-left:1px solid rgba(148,163,184,0.4);
      box-shadow:-16px 0 30px rgba(0,0,0,0.7);
      transform:translateX(100%);
      transition:transform .25s ease-out;
      z-index:60;
      padding:20px 18px;
    }
    .side-menu.active { transform:translateX(0); }

    .side-menu ul {
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .side-menu li {
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      border:1px solid rgba(148,163,184,0.35);
      background:rgba(20,27,48,0.95);
      transition:.2s;
    }
    .side-menu li.locked {
      opacity:0.4;
      cursor:not-allowed;
      border-style:dashed;
    }
  </style>
</head>

<body>

<script>
function createSnowflake(){
  const s=document.createElement("div");
  s.className="snowflake";
  s.textContent="â„";
  s.style.left=Math.random()*100+"vw";
  s.style.fontSize=10+Math.random()*18+"px";
  s.style.animationDuration=4+Math.random()*6+"s";
  s.style.opacity=0.4+Math.random()*0.4;
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),11000);
}
setInterval(createSnowflake,200);
</script>

<div id="menu-overlay" class="menu-overlay hidden"></div>

<nav id="side-menu" class="side-menu hidden">
  <h3>Navigation</h3>
  <ul>
    <li data-target="puzzle-0"><span class="label">RÃ¤tsel 1</span><span class="tag">Start</span></li>
    <li data-target="puzzle-1"><span class="label">RÃ¤tsel 2</span></li>
    <li data-target="puzzle-2"><span class="label">RÃ¤tsel 3</span></li>
    <li data-target="puzzle-3"><span class="label">RÃ¤tsel 4</span></li>
    <li data-target="puzzle-4"><span class="label">RÃ¤tsel 5</span></li>
    <li data-target="puzzle-5"><span class="label">RÃ¤tsel 6</span></li>
    <li data-target="final-card"><span class="label">Finale</span></li>
  </ul>
</nav>

<button id="burger-btn" class="burger-btn">
  <div class="burger-lines">
    <span></span><span></span><span></span>
  </div>
</button>

<div class="container">

  <div class="title">
    <h1>ðŸŽ„ 3eryk? WeihnachtsrÃ¤tsel â€“ 2025 Edition ðŸŽ„</h1>
    <div id="countdown">Lade Countdown...</div>
  </div>

  <!-- Admin -->
  <div class="card">
    <div class="card-header"><span class="badge">Admin</span><h2>Admin Login</h2></div>
    <input id="admin-pass" type="password" placeholder="Passwort">
    <button id="admin-btn">Login</button>
    <div id="admin-msg" class="message"></div>
  </div>

  <!-- Intro -->
  <div class="card">
    <div class="card-header"><span class="badge">Intro</span><h2>Willkommen!</h2></div>
    <iframe src="https://www.youtube.com/embed/TGvnbko2Jio?si=z0f59smM_qRPTszH" allowfullscreen></iframe>
  </div>

  <!-- Fortschritt -->
  <div class="card">
    <div class="card-header"><span class="badge">Fortschritt</span><h2>Gesammelte Zeichen</h2></div>
    <div class="letters-progress" id="letters-progress">
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span><span>_</span><span>_</span>
      <span>_</span><span>_</span><span>_</span>
    </div>
  </div>

  <!-- NÃ„CHSTES RÃ„TSEL -->
  <div class="card" id="next-unlock-card">
    <div class="card-header"><span class="badge">Info</span><h2>NÃ¤chstes RÃ¤tsel</h2></div>
    <div id="next-unlock-text">Lade...</div>
    <div id="next-unlock-countdown"></div>
  </div>

  <!-- QR CODE BLOCK -->
  <div class="card" id="qr-hint-card">
    <div class="card-header">
      <span class="badge">QR-Code</span>
      <h2>Zusatzaufgabe</h2>
    </div>
    <p>
      <strong>Findet alle Teile des QR-Codes mithilfe von Firoâ€¦</strong>
    </p>
    <p style="margin-top:10px;color:var(--text-muted);font-size:0.9rem;">
      ðŸ’¡ Es existieren mehrere Teile. Erst zusammensetzen â†’ dann scannen.
    </p>
  </div>
<script>
// ---------- GLOBALS ----------
let ADMIN_MODE = false;
const ADMIN_PASSWORD = "SuperYK2025";

let progress = JSON.parse(localStorage.getItem("XMASRIDDLE_GLOBAL") || "{}");

const unlockSchedule = {
  0: new Date("December 1, 2025 18:00:00").getTime(),
  1: new Date("December 8, 2025 18:00:00").getTime(),
  2: new Date("December 10, 2025 18:00:00").getTime(),
  3: new Date("December 16, 2025 18:00:00").getTime(),
  4: new Date("December 22, 2025 18:00:00").getTime(),
  5: new Date("December 28, 2025 20:00:00").getTime()
};

function isUnlocked(i) {
  return ADMIN_MODE || Date.now() >= unlockSchedule[i];
}

function saveProgress() {
  localStorage.setItem("XMASRIDDLE_GLOBAL", JSON.stringify(progress));
}

// ---------- COUNTDOWN ----------
function formatDiff(diff) {
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);

  const parts = [];
  if (d > 0) parts.push(`${d}T`);
  if (h > 0) parts.push(`${h}h`);
  if (m > 0) parts.push(`${m}m`);
  if (s > 0) parts.push(`${s}s`);
  return parts.join(" ");
}

function updateCountdown() {
  const target = unlockSchedule[5];
  const diff = target - Date.now();
  const el = document.getElementById("countdown");

  if (diff <= 0) {
    el.textContent = "Es ist so weit! ðŸŽ„";
    return;
  }
  el.textContent = formatDiff(diff);
}
setInterval(updateCountdown, 1000);
updateCountdown();

// ---------- AUDIO ----------
let audioCtx = null;
function getAudioCtx() {
  if (!audioCtx) {
    const C = window.AudioContext || window.webkitAudioContext;
    if (C) audioCtx = new C();
  }
  return audioCtx;
}

function beep(freq, dur, type="sine", vol=0.10) {
  const c = getAudioCtx(); if (!c) return;
  const o = c.createOscillator(), g = c.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g); g.connect(c.destination);
  const now = c.currentTime;
  o.start(now);
  o.stop(now + dur);
  g.gain.setValueAtTime(vol, now);
  g.gain.linearRampToValueAtTime(0, now + dur);
}

function clickSound() { beep(650, 0.07, "triangle", 0.1); }
function successSound() { beep(880,0.1); setTimeout(()=>beep(1040,0.1),90); }
function errorSound() { beep(220,0.15,"square",0.15); }

// ---------- LETTER DISPLAY ----------
const slots = document.querySelectorAll("#letters-progress span");
let nextIndex = progress.letters ? progress.letters.length : 0;

function addLetter(ch) {
  if (nextIndex < slots.length) {
    slots[nextIndex].textContent = ch;
    slots[nextIndex].classList.add("filled");
    nextIndex++;
  }
}

if (progress.letters) {
  progress.letters.forEach(l => addLetter(l));
}

// ---------- QUIZ ----------
let quizSolved = progress.quizSolved || {};
let quizSolvedCount = Object.keys(quizSolved).length;
document.getElementById("quiz-summary").textContent =
  `${quizSolvedCount} von 8 gelÃ¶st`;

function checkQuiz(n) {
  clickSound();

  const input = document.getElementById("q" + n);
  const msg = document.getElementById("m" + n);

  if (quizSolved[n]) {
    msg.textContent = "Schon gelÃ¶st!";
    msg.className = "message success";
    return;
  }

  let val = input.value.trim().toLowerCase();

  const solutions = {
    1: "3",
    2: "25.09.2024",
    3: "rot ist meine lieblings zahl im ganzen alphabet",
    4: "wann",
    5: "i",
    6: "t",
    7: "e",
    8: "47"
  };

  const letters = {
    1: "3",
    2: "e",
    3: "r",
    4: "y",
    5: "?",
    6: "2",
    7: "0",
    8: "2"
  };

  if (val === solutions[n].toLowerCase()) {
    msg.textContent = "Korrekt!";
    msg.className = "message success";
    successSound();

    quizSolved[n] = true;
    progress.quizSolved = quizSolved;

    progress.letters = progress.letters || [];
    progress.letters.push(letters[n]);
    addLetter(letters[n]);

    saveProgress();

    quizSolvedCount++;
    document.getElementById("quiz-summary").textContent =
      quizSolvedCount === 8 ? "Alle 8 gelÃ¶st! ðŸŽ‰" :
      `${quizSolvedCount} von 8 gelÃ¶st`;

    updateVisibility();

  } else {
    msg.textContent = "Falsch!";
    msg.className = "message error";
    errorSound();
  }
}

// ---------- SPOTIFY ----------
function checkSpotify() {
  clickSound();

  const a = document.getElementById("sp1").value.toLowerCase();
  const b = document.getElementById("sp2").value.toLowerCase();
  const c = document.getElementById("sp3").value.toLowerCase();

  const msg = document.getElementById("sp-msg");

  if (a === "s" && b === "t" && c === "a") {
    msg.textContent = "Korrekt!";
    msg.className = "message success";
    successSound();

    progress.spotify = true;
    progress.letters = progress.letters || [];

    ["W","e","i","h"].forEach(l => {
      progress.letters.push(l);
      addLetter(l);
    });

    saveProgress();
    updateVisibility();
  } else {
    msg.textContent = "Falsch!";
    msg.className = "message error";
    errorSound();
  }
}

// ---------- FINALE ----------
function checkFinal() {
  clickSound();

  const val = document.getElementById("final-input").value.trim();
  const msg = document.getElementById("final-msg");

  if (val === "3eryk?2025Weihnachtsedition") {
    msg.textContent = "Richtig! ðŸŽ‰";
    msg.className = "message success";
    successSound();
  } else {
    msg.textContent = "Falsch!";
    msg.className = "message error";
    errorSound();
  }
}

// ---------- ADMIN MODE ----------
document.getElementById("admin-btn").addEventListener("click", () => {
  clickSound();
  const val = document.getElementById("admin-pass").value.trim();
  const msg = document.getElementById("admin-msg");

  if (val === ADMIN_PASSWORD) {
    ADMIN_MODE = true;
    msg.textContent = "Admin-Modus aktiviert!";
    msg.className = "message success";
    successSound();
    updateVisibility();
  } else {
    msg.textContent = "Falsch!";
    msg.className = "message error";
    errorSound();
  }
});

// ---------- BURGER MENU ----------
const burgerBtn = document.getElementById("burger-btn");
const sideMenu = document.getElementById("side-menu");
const overlay = document.getElementById("menu-overlay");

burgerBtn.addEventListener("click", () => {
  clickSound();
  sideMenu.classList.toggle("active");
  overlay.classList.toggle("active");
});

overlay.addEventListener("click", () => {
  clickSound();
  sideMenu.classList.remove("active");
  overlay.classList.remove("active");
});

document.querySelectorAll("#side-menu li").forEach(li => {
  li.addEventListener("click", () => {
    clickSound();
    if (li.classList.contains("locked") && !ADMIN_MODE) {
      errorSound();
      return;
    }
    const id = li.dataset.target;
    const el = document.getElementById(id);
    if (el) el.scrollIntoView({behavior:"smooth"});
    sideMenu.classList.remove("active");
    overlay.classList.remove("active");
  });
});

// ---------- MENÃœ TITEL (kein Spoilern) ----------
function updateMenuTitles() {
  const menuItems = document.querySelectorAll("#side-menu li");

  menuItems.forEach((li, index) => {
    const label = li.querySelector(".label");
    const target = li.dataset.target;

    // Finale bleibt Finale
    if (target === "final-card") {
      label.textContent = "Finale";
      return;
    }

    // Locked â†’ nur â€žRÃ¤tsel Xâ€œ
    if (li.classList.contains("locked") && !ADMIN_MODE) {
      label.textContent = `RÃ¤tsel ${index + 1}`;
      return;
    }

    // Unlocked â†’ echte Bezeichnungen
    switch (index) {
      case 0: label.textContent = "RÃ¤tsel 1 â€“ Quiz"; break;
      case 5: label.textContent = "RÃ¤tsel 6 â€“ Spotify"; break;
      default: label.textContent = `RÃ¤tsel ${index + 1}`;
    }
  });
}

// ---------- VISIBILITY ----------
function updateVisibility() {
  const puzzles = document.querySelectorAll(".puzzle-card");

  puzzles.forEach(p => p.classList.add("hidden"));
  document.getElementById("final-card").classList.add("hidden");

  // RÃ¤tsel 1
  if (isUnlocked(0))
    document.getElementById("puzzle-0").classList.remove("hidden");

  // MenÃ¼-Lock setzen
  document.querySelectorAll("#side-menu li").forEach((li, index) => {
    const target = li.dataset.target;
    const el = document.getElementById(target);
    if (ADMIN_MODE || !el.classList.contains("hidden")) {
      li.classList.remove("locked");
    } else {
      li.classList.add("locked");
    }
  });

  // RÃ¤tsel 2â€“5 erst nach abgeschlossenem Quiz
  if (quizSolvedCount === 8 || ADMIN_MODE) {
    for (let i=1;i<=4;i++) {
      if (isUnlocked(i) || ADMIN_MODE) {
        document.getElementById("puzzle-"+i).classList.remove("hidden");
      }
    }
  }

  // RÃ¤tsel 6 (Spotify)
  if ((quizSolvedCount === 8 && isUnlocked(5)) || ADMIN_MODE) {
    document.getElementById("puzzle-5").classList.remove("hidden");
  }

  // Finale
  if (ADMIN_MODE ||
     (quizSolvedCount === 8 && progress.spotify === true)) {
    document.getElementById("final-card").classList.remove("hidden");
  }

  updateNextUnlockBox();
  updateMenuTitles();
}

// ---------- NEXT UNLOCK ----------
function updateNextUnlockBox() {
  const txt = document.getElementById("next-unlock-text");
  const cd = document.getElementById("next-unlock-countdown");

  for (let i=0;i<=5;i++) {
    if (!isUnlocked(i)) {
      txt.textContent = `RÃ¤tsel ${i+1}`;
      cd.textContent = formatDiff(unlockSchedule[i] - Date.now());
      return;
    }
  }
  txt.textContent = "Alle RÃ¤tsel sind freigeschaltet!";
  cd.textContent = "";
}
setInterval(updateNextUnlockBox, 1000);

// ---------- RESTORE ----------
updateVisibility();

// ---------- RESET ----------
document.getElementById("reset-progress").addEventListener("click", () => {
  clickSound();
  localStorage.removeItem("XMASRIDDLE_GLOBAL");
  location.reload();
});
</script>

</body>
</html>
